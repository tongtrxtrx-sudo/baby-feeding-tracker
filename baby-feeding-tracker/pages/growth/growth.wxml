<view class="container">
  <view wx:if="{{!currentBaby}}" class="empty-state">
    <view class="empty-icon">
      <text style="font-size: 80rpx;">ğŸ‘¶</text>
    </view>
    <view class="empty-text">è¯·å…ˆæ·»åŠ å®å®æ¡£æ¡ˆ</view>
    <button class="add-btn btn-primary" bindtap="goToProfile">å»æ·»åŠ </button>
  </view>

  <view wx:if="{{currentBaby}}" class="content">
    <view class="chart-tabs">
      <view class="tab-item {{currentTab === 'weight' ? 'active' : ''}}" bindtap="switchTab" data-tab="weight">
        ä½“é‡æ›²çº¿
      </view>
      <view class="tab-item {{currentTab === 'height' ? 'active' : ''}}" bindtap="switchTab" data-tab="height">
        èº«é«˜æ›²çº¿
      </view>
    </view>

    <view class="chart-card card">
      <view class="chart-header">
        <view class="chart-title">{{currentTab === 'weight' ? 'ä½“é‡' : 'èº«é«˜'}}ç”Ÿé•¿æ›²çº¿</view>
        <view class="chart-unit">{{currentTab === 'weight' ? 'kg' : 'cm'}}</view>
      </view>
      <view wx:if="{{chartData}}" class="chart-wrapper">
        <growth-chart 
          chart-data="{{chartData}}" 
          baby-records="{{babyRecords}}" 
          chart-type="{{currentTab}}"
        ></growth-chart>
      </view>
      <view wx:else class="chart-placeholder">
        <view class="placeholder-text">æš‚æ— æ•°æ®</view>
        <view class="placeholder-desc">æ·»åŠ èº«é«˜ä½“é‡è®°å½•åæ˜¾ç¤ºæ›²çº¿</view>
      </view>
    </view>

    <view class="standard-card card">
      <view class="standard-title">WHOæ ‡å‡†ç™¾åˆ†ä½</view>
      <view wx:if="{{currentStandard}}" class="standard-values">
        <view class="value-item">
          <view class="value-label">P3 (åä½)</view>
          <view class="value-number">{{currentStandard.p3}}{{currentTab === 'weight' ? 'kg' : 'cm'}}</view>
        </view>
        <view class="value-item">
          <view class="value-label">P15</view>
          <view class="value-number">{{currentStandard.p15}}{{currentTab === 'weight' ? 'kg' : 'cm'}}</view>
        </view>
        <view class="value-item">
          <view class="value-label">P50 (ä¸­ä½)</view>
          <view class="value-number">{{currentStandard.p50}}{{currentTab === 'weight' ? 'kg' : 'cm'}}</view>
        </view>
        <view class="value-item">
          <view class="value-label">P85</view>
          <view class="value-number">{{currentStandard.p85}}{{currentTab === 'weight' ? 'kg' : 'cm'}}</view>
        </view>
        <view class="value-item">
          <view class="value-label">P97 (åé«˜)</view>
          <view class="value-number">{{currentStandard.p97}}{{currentTab === 'weight' ? 'kg' : 'cm'}}</view>
        </view>
      </view>
      <view wx:else class="standard-loading">
        <text>æ­£åœ¨åŠ è½½WHOæ ‡å‡†æ•°æ®...</text>
      </view>
      <view class="standard-legend-title">æ›²çº¿è¯´æ˜</view>
      <view class="standard-legend">
        <view class="legend-item">
          <view class="legend-line" style="background: #A8E6CF;"></view>
          <view class="legend-text">P50 - ä¸­ä½çº¿ï¼ˆæ ‡å‡†å€¼ï¼‰</view>
        </view>
        <view class="legend-item">
          <view class="legend-line" style="background: #FFD4A3;"></view>
          <view class="legend-text">P15-P85 - æ­£å¸¸èŒƒå›´</view>
        </view>
        <view class="legend-item">
          <view class="legend-line" style="background: #FFB8B8;"></view>
          <view class="legend-text">P3 - åä½ä¸´ç•Œçº¿</view>
        </view>
        <view class="legend-item">
          <view class="legend-line" style="background: #7EC8E3;"></view>
          <view class="legend-text">P97 - åé«˜ä¸´ç•Œçº¿</view>
        </view>
        <view class="legend-item">
          <view class="legend-dot" style="background: #FF8C69;"></view>
          <view class="legend-text">å®å®ç”Ÿé•¿æ›²çº¿</view>
        </view>
      </view>
    </view>

    <view class="add-btn-wrapper">
      <button class="add-growth-btn btn-primary" bindtap="showAddModal">
        <text style="font-size: 32rpx; margin-right: 8rpx;">â•</text>
        <text>è®°å½•èº«é«˜ä½“é‡</text>
      </button>
    </view>

    <view wx:if="{{growths.length > 0}}" class="growth-list">
      <view class="list-header">
        <view class="list-title">å†å²è®°å½•</view>
      </view>
      <view wx:for="{{growths}}" wx:key="id" class="growth-card card">
        <view class="growth-header flex-between">
          <view class="growth-date">{{item.date}}</view>
          <view class="growth-actions">
            <view class="growth-edit" bindtap="editGrowth" data-id="{{item.id}}">
              <text style="font-size: 32rpx;">âœï¸</text>
            </view>
            <view class="growth-delete" bindtap="deleteGrowth" data-id="{{item.id}}">
              <text style="font-size: 32rpx;">ğŸ—‘ï¸</text>
            </view>
          </view>
        </view>
        <view class="growth-body flex-between">
          <view class="growth-item">
            <view class="growth-value text-primary">{{item.weight}}kg</view>
            <view class="growth-label text-secondary">ä½“é‡</view>
          </view>
          <view class="growth-divider"></view>
          <view class="growth-item">
            <view class="growth-value text-primary">{{item.height}}cm</view>
            <view class="growth-label text-secondary">èº«é«˜</view>
          </view>
          <view class="growth-divider" wx:if="{{item.headCircumference}}"></view>
          <view class="growth-item" wx:if="{{item.headCircumference}}">
            <view class="growth-value text-primary">{{item.headCircumference}}cm</view>
            <view class="growth-label text-secondary">å¤´å›´</view>
          </view>
        </view>
        <view wx:if="{{item.note}}" class="growth-note text-secondary">
          {{item.note}}
        </view>
      </view>
    </view>

    <view wx:if="{{growths.length === 0}}" class="no-data">
      <view class="no-data-icon">
        <text style="font-size: 80rpx;">ğŸ“</text>
      </view>
      <view class="no-data-text">æš‚æ— ç”Ÿé•¿è®°å½•</view>
    </view>
  </view>
</view>

<view wx:if="{{showModal}}" class="modal-mask" bindtap="hideModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <view class="modal-title">{{editingId ? 'ç¼–è¾‘ç”Ÿé•¿æ•°æ®' : 'è®°å½•ç”Ÿé•¿æ•°æ®'}}</view>
      <view class="modal-close" bindtap="hideModal">
        <text style="font-size: 40rpx;">âœ•</text>
      </view>
    </view>
    <view class="modal-body">
      <view class="form-item">
        <view class="form-label">è®°å½•æ—¥æœŸ</view>
        <picker mode="date" value="{{formData.date}}" bindchange="onDateChange">
          <view class="form-picker">{{formData.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
        </picker>
      </view>
      <view class="form-item">
        <view class="form-label">ä½“é‡ (kg)</view>
        <input class="form-input" type="digit" placeholder="ä¾‹å¦‚: 7.5" value="{{formData.weight}}" bindinput="onInput" data-field="weight" />
      </view>
      <view class="form-item">
        <view class="form-label">èº«é«˜ (cm)</view>
        <input class="form-input" type="digit" placeholder="ä¾‹å¦‚: 68" value="{{formData.height}}" bindinput="onInput" data-field="height" />
      </view>
      <view class="form-item">
        <view class="form-label">å¤´å›´ (cmï¼Œå¯é€‰)</view>
        <input class="form-input" type="digit" placeholder="ä¾‹å¦‚: 42" value="{{formData.headCircumference}}" bindinput="onInput" data-field="headCircumference" />
      </view>
      <view class="form-item">
        <view class="form-label">å¤‡æ³¨ (å¯é€‰)</view>
        <input class="form-input" placeholder="æ·»åŠ å¤‡æ³¨" value="{{formData.note}}" bindinput="onInput" data-field="note" />
      </view>
    </view>
    <view class="modal-footer flex">
      <button class="modal-btn btn-secondary" bindtap="hideModal">å–æ¶ˆ</button>
      <button class="modal-btn btn-primary" bindtap="saveGrowth">ä¿å­˜</button>
    </view>
  </view>
</view>
